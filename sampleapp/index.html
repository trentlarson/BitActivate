<!DOCTYPE html>
<html>
  <head>
  <title>Sample</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">

  <script src="./lib/jquery-2.1.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

  <script>
  var spawn = require('child_process').spawn;
  var FEATURE_SET = [{code:"PREMIUM_FEATURE", desc:"Premium Features", price:0.30, currency:"EUR"}]

  function checkIsActive(feature) {
    $('#waitOnActivate').show();

    var nwProc = process.execPath;
    baProc = spawn(nwProc, ['../ba', '{"function":"IsActive","feature":"' + feature.code + '"}']);

    baProc.stdout.on('data', function (data) {
      console.log('stdout: ' + data);
      result = JSON.parse(data);
      console.log("result is: " + result.result);
    });

    baProc.stderr.on('data', function (data) {
      console.log('stderr: ' + data);
    });

    baProc.on('close', function (code) {
      console.log('BitActivate library exited with code ' + code);
      $('#waitOnActivate').hide();
      if (code == 0 || code == 1) {
        // they closed the window or cancelled, so do nothing
      } else if (code == 99) {
        $('#accessDenied').hide();
        $('#payNow').hide();
        $('#pleasePay').hide();
        $('#premiumPanel').removeClass("panel-danger");
        $('.free').hide();

        $('#premiumPanel').addClass("panel-primary");
        $('.premium').show();
      } else {
        console.log("Ack!  BitActivate gave me this unrecognized code: " + code);
      }
    });
  }

  function activateFeature(feature) {
    $('#waitOnActivate').show();
    var nwProc = process.execPath;
    baProc = spawn(nwProc, ['../ba', '{"function":"Activate","feature":"' + feature.code + '", "description":"' + feature.desc + '", "address":"1NCzNp6Fkh8YeHf4H3BwUoiPvPkJ1j1f8P","price":' + feature.price + ',"currency":"' + feature.currency + '"}']);

    baProc.stdout.on('data', function (data) {
      console.log('stdout: ' + data);
      result = JSON.parse(data);
      console.log("result is: " + result.result);
    });

    baProc.stderr.on('data', function (data) {
      console.log('stderr: ' + data);
    });

    baProc.on('close', function (code) {
      console.log('BitActivate library exited with code ' + code);
      $('#waitOnActivate').hide();
      if (code == 0 || code == 1) {
        // they closed the window or cancelled, so do nothing
      } else if (code == 99) {
        $('#accessDenied').hide();
        $('#payNow').hide();
        $('#pleasePay').hide();
        $('#premiumPanel').removeClass("panel-danger");
        $('.free').hide();

        $('#thanksPay').show();
        $('#premiumPanel').addClass("panel-success");
        $('.premium').show();
      } else {
        console.log("Ack!  BitActivate gave me this unrecognized code: " + code);
      }
    });
  }

  $( document ).ready(function() {
    $('#feature-desc').text($('#feature-desc').text() + " " + FEATURE_SET[0].desc);
    $('#waitOnActivate').hide();
    $('#thanksPay').hide();
    $('.premium').hide();
    for (var i = 0; i < FEATURE_SET.length; i++) {
      checkIsActive(FEATURE_SET[i]);
    }
  });
  </script>
  </head>
  <body>
    <h1>A Sample Application</h1>
    <div style="text-align:center;">
      <span id="pleasePay"><strong>Hi!  I hope you will pay Bitcoin for my premium features.  :-)</strong></span>
      <span id="thanksPay" class="alert-success"><strong>Thanks for your payment!  Enjoy your premium features.</strong></span>
    </div>
    <div class="panel panel-primary">
      <div class="panel-heading"><h2>Free Features</h2></div>
      <div class="panel-body">
	Enjoy my free features.
	<ul>
	  <li><input type="button" value="O fortuna"></li>
	  <li><input type="button" value="Velut luna"></li>
	  <li><input type="button" value="Statu variabilis!"></li>
	</ul>
      </div>
    </div>
    <div id="premiumPanel" class="panel panel-danger">
      <div class="panel-heading"><h2><span id="feature-desc">Paid</span></h2></div>
      <div class="panel-body">
	<div style="row">
	  <div class="col-md-4">
	    <span class="free">If you pay, you can have these features, too!</span>
	    <span class="premium">Now you have these features, too!</span>
	    <ul>
	      <li><span class="free">Semper crecis</span><span class="premium"><input type="button" value="Semper crecis"></span></li>
	      <li><span class="free">Aut decrecis</span><span class="premium"><input type="button" value="Aut decrecis"></span></li>
	      <li><span class="free">Vita detestabilis</span><span class="premium"><input type="button" value="Vita detestabilis"></span></li>
	    </ul>
	  </div>
	  <div class="col-md-8">
	    <img id="accessDenied" src="lib/access-denied.jpeg" height="100">
	    <a href="#" onclick="javascript:activateFeature(FEATURE_SET[0]);">
	      <img id="payNow" src="lib/pay-now.png" height="100">
	    </a>
	    <img id="waitOnActivate" src="lib/loadera64.gif" height="50" width="50"/>
	  </div>
	</div>
      </div>
    </div>
  </body>
</html>
