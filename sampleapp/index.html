<!DOCTYPE html>
<html>
  <head>
  <title>Sample</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">

  <script src="./lib/jquery-2.1.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

  <script>
  var spawn = require('child_process').spawn;
  var FEATURE_CODE = "PREMIUM_FEATURE";

  function checkIsActive() {
    $('#waitOnActivate').show();

    var nwProc = process.execPath;
    baProc = spawn(nwProc, ['../ba', '{"function":"IsActive","feature":"' + FEATURE_CODE + '"}']);

    baProc.stdout.on('data', function (data) {
      console.log('stdout: ' + data);
      result = JSON.parse(data);
      console.log("result is: " + result.result);
    });

    baProc.stderr.on('data', function (data) {
      console.log('stderr: ' + data);
    });

    baProc.on('close', function (code) {
      console.log('BitActivate library exited with code ' + code);
      $('#waitOnActivate').hide();
      if (code == 0 || code == 1) {
        // they closed the window or cancelled, so do nothing
      } else if (code == 99) {
        $('#accessDenied').hide();
        $('#payNow').hide();
        $('#pleasePay').hide();
        $('#premiumPanel').removeClass("panel-danger");

        $('#premiumPanel').addClass("panel-primary");
      } else {
        console.log("Ack!  BitActivate gave me this unrecognized code: " + code);
      }
    });
  }

  function spawnOther() {
    $('#waitOnActivate').show();
    var nwProc = process.execPath;
    baProc = spawn(nwProc, ['../ba', '{"function":"Activate","feature":"' + FEATURE_CODE + '", "description":"A Premium Feature", "address":"1NCzNp6Fkh8YeHf4H3BwUoiPvPkJ1j1f8P","price":0.25,"currency":"USD"}']);

    baProc.stdout.on('data', function (data) {
      console.log('stdout: ' + data);
      result = JSON.parse(data);
      console.log("result is: " + result.result);
    });

    baProc.stderr.on('data', function (data) {
      console.log('stderr: ' + data);
    });

    baProc.on('close', function (code) {
      console.log('BitActivate library exited with code ' + code);
      $('#waitOnActivate').hide();
      if (code == 0 || code == 1) {
        // they closed the window or cancelled, so do nothing
      } else if (code == 99) {
        $('#accessDenied').hide();
        $('#payNow').hide();
        $('#pleasePay').hide();
        $('#premiumPanel').removeClass("panel-danger");

        $('#thanksPay').show();
        $('#premiumPanel').addClass("panel-success");
      } else {
        console.log("Ack!  BitActivate gave me this unrecognized code: " + code);
      }
    });
  }

  $( document ).ready(function() {
    $('#waitOnActivate').hide();
    $('#thanksPay').hide();
    checkIsActive();
  });
  </script>
  </head>
  <body>
    <h1>A Sample Application</h1>
    <div style="text-align:center;">
      <span id="pleasePay"><strong>Hi!  I hope you will pay Bitcoin for my premium features.  :-)</strong></span>
      <span id="thanksPay" class="alert-success"><strong>Thanks for your payment!  Enjoy your premium features.</strong></span>
    </div>
    <div class="panel panel-primary">
      <div class="panel-heading">Free Features</div>
      <div class="panel-body">
	Enjoy my free features.
	<ul>
	  <li>O fortuna</li>
	  <li>Velut luna</li>
	  <li>Statu variabilis!</li>
	</ul>
      </div>
    </div>
    <div id="premiumPanel" class="panel panel-danger">
      <div class="panel-heading">Paid Premium Features</div>
      <div class="panel-body">
	<div style="row">
	  <div class="col-md-4">
	    If you pay, you can have these features, too!
	    <ul>
	      <li>Semper crecis</li>
	      <li>Aut decrecis</li>
	      <li>Vita detestabilis...</li>
	    </ul>
	  </div>
	  <div class="col-md-8">
	    <img id="accessDenied" src="lib/access-denied.jpeg" height="100">
	    <a href="#" onclick="javascript:spawnOther();">
	      <img id="payNow" src="lib/pay-now.png" height="100">
	    </a>
	    <img id="waitOnActivate" src="lib/loadera64.gif" height="50" width="50"/>
	  </div>
	</div>
      </div>
    </div>
  </body>
</html>
